<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="../css/detail.css" rel="stylesheet" type="text/css" />

  <title>Document</title>
</head>



<body>
  <form action="/api/comments" method="POST">
    <h3>댓글 작성하기</h3>
    <div>
      <label>닉네임</label>
      <input type="text" name="postContent" />
    </div>
    <div>
      <label>userId</label>
      <input type="text" name="userId" />
    </div>
    <div>
      <label>postId</label>
      <input type="text" name="postId" />
    </div>
    <div>
      <label>댓글 내용</label>
      <input type="text" name="nickname" />
    </div>
    <button type="submit">작성</button>
  </form>

  <h3>댓글 목록</h3>
  <div class="commentsList">
  </div>
  <script>

    document.addEventListener("DOMContentLoaded", commentListing);
    async function commentListing() {
      const response = await fetch("http://localhost:3000/api/comments");
      const allComments = await response.json();
      if (allComments.length == 1 && allComments[0].errorMessage) {
        const commentsList = document.querySelector(".commentsList")
        commentsList.innerHTML = allComments[0].errorMessage
      }
      else {
        const commentsList = document.querySelector(".commentsList")
        commentsList.innerHTML = allComments.allComments.map(comment => {
          return `<div>
                    <div type="hidden" id="hiddencomment" value = ${comment.commentId}/>
                      <div>
                        내용 : ${comment.content}
                      </div>
                      <div>
                        작성일 : ${comment.createdAt}
                      </div>
                      <div>
                        수정일 : ${comment.updatedAt}
                      </div>
                  </div>
                  <button id="open-modal">수정</button>
                  <div id="modal">
                    <div class="modal-content">
                      <h3>댓글 수정하기</h3>
                      <input type="text" id="editContent"/>
                      <button id="close-modal">닫기</button>
                      <button id="edit" onclick="editpost()">수정하기</button>
                    </div>
                  </div>

                 `
        }).join("")
      }
      //모달 
      const modal = document.getElementById("modal");
      const openModalBtn = document.getElementById("open-modal");
      const closeModalBtn = document.getElementById("close-modal");
      // 모달창 열기
      openModalBtn.addEventListener("click", () => {
        modal.style.display = "block";
        document.body.style.overflow = "hidden"; // 스크롤바 제거
      });
      // 모달창 닫기
      closeModalBtn.addEventListener("click", () => {
        modal.style.display = "none";
        document.body.style.overflow = "auto"; // 스크롤바 보이기
      });
    }





    // 수정하기
    async function editpost() {
      try {
        const response = await fetch("http://localhost:3000/api/comments", {
          method: "PATCH",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            editContent: document.getElementById("editContent").value
          }),
        });
        const result = await response.json();
        console.log("Success:", result);
      } catch (error) {
        console.error("Error:", error);
      }
    }
  </script>
</body>xw

</html>